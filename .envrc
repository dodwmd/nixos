use nix

export KUBECONFIG="$HOME/code/nixos/k3s-kubeconfig"

# Fetch the kubeconfig from the k3s master if it doesn't exist or is older than 1 day
if [[ ! -f "$KUBECONFIG" ]]; then
    echo "Fetching k3s kubeconfig from master node..."
    scp 192.168.1.20:~/.kube/config "$KUBECONFIG" 2>/dev/null || {
        echo "Failed to fetch kubeconfig. Make sure you can SSH to k3s-master-01 (192.168.1.210)"
        return 1
    }
    # Update server address to use the master node IP
    sed -i 's/127.0.0.1:6443/192.168.1.20:6443/g' "$KUBECONFIG"
fi

echo "Using k3s cluster at k3s-master-01 (192.168.1.20)"

